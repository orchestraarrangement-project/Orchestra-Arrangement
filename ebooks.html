<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ebooks - Orchestra</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <img src="imagens/logo-branca.png" alt="Orchestra" style="height: 40px;">
            </div>

            <ul class="nav-menu">
                <li><a href="index.html">Início</a></li>
                <li><a href="partituras.html">Partituras</a></li>
                <li><a href="ebooks.html" class="active">Ebooks</a></li>
            </ul>
        </div>
    </nav>

    <section class="hero">
        <div class="container">
            <h1>Ebooks Musicais</h1>
            <p>Aprenda teoria musical, leitura de partituras e muito mais com nossos ebooks especializados</p>
        </div>
    </section>

    <section class="filters-section">
        <div class="container">
            <div class="filters">
                <select id="categoriaFilter" onchange="carregarEbooks()">
                    <option value="">Todas as Categorias</option>
                    <option value="Teoria Musical">Teoria Musical</option>
                    <option value="História da Música">História da Música</option>
                    <option value="Técnica Instrumental">Técnica Instrumental</option>
                </select>

                <select id="nivelFilter" onchange="carregarEbooks()">
                    <option value="">Todos os Níveis</option>
                    <option value="Iniciante">Iniciante</option>
                    <option value="Intermediário">Intermediário</option>
                    <option value="Avançado">Avançado</option>
                </select>
            </div>
        </div>
    </section>

    <section class="content-section">
        <div class="container">
            <p class="results-count" id="resultsCount">Carregando ebooks...</p>
            <div class="ebooks-grid" id="ebooksGrid">
                <!-- Cards serão inseridos aqui -->
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Orchestra Arrangement. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script>
        let todosEbooks = [];

        async function carregarEbooks() {
            try {
                const categoriaFiltro = document.getElementById('categoriaFilter').value;
                const nivelFiltro = document.getElementById('nivelFilter').value;

                let query = supabase
                    .from('cursos')
                    .select('*')
                    .eq('status', 'Publicado')
                    .order('created_at', { ascending: false });

                if (categoriaFiltro) {
                    query = query.eq('categoria', categoriaFiltro);
                }

                if (nivelFiltro) {
                    query = query.eq('nivel', nivelFiltro);
                }

                const { data, error } = await query;

                if (error) {
                    console.error('Erro ao carregar ebooks:', error);
                    document.getElementById('ebooksGrid').innerHTML = 
                        '<p style="text-align: center; padding: 40px; color: #666;">Erro ao carregar ebooks</p>';
                    return;
                }

                todosEbooks = data || [];
                renderizarEbooks(todosEbooks);

            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('ebooksGrid').innerHTML = 
                    '<p style="text-align: center; padding: 40px; color: #666;">Erro ao carregar ebooks</p>';
            }
        }

        function renderizarEbooks(ebooks) {
            const grid = document.getElementById('ebooksGrid');
            const resultsCount = document.getElementById('resultsCount');

            if (ebooks.length === 0) {
                grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #666;">Nenhum ebook encontrado</p>';
                resultsCount.textContent = '0 ebooks encontrados';
                return;
            }

            resultsCount.textContent = `${ebooks.length} ebook${ebooks.length !== 1 ? 's' : ''} encontrado${ebooks.length !== 1 ? 's' : ''}`;

            grid.innerHTML = ebooks.map(ebook => `
                <div class="card">
                    <div class="card-image">
                        <img src="${ebook.imagem_capa || 'https://images.unsplash.com/photo-1543002588-bfa74002ed7e?w=800'}" alt="${ebook.titulo}">
                        ${ebook.nivel ? `<span class="badge badge-${getNivelClass(ebook.nivel)}">${ebook.nivel}</span>` : ''}
                    </div>
                    <div class="card-content">
                        <h3>${ebook.titulo}</h3>
                        <p class="card-description">${ebook.descricao || 'Sem descrição disponível'}</p>
                        ${ebook.categoria ? `<span class="category-tag">${ebook.categoria}</span>` : ''}
                        <div class="card-footer">
                            <span class="price">${ebook.preco || 'Grátis'}</span>
                            <a href="ebook-detalhes.html?id=${ebook.id}" class="btn-card">Ver Detalhes</a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getNivelClass(nivel) {
            const map = {
                'Iniciante': 'green',
                'Intermediário': 'yellow',
                'Avançado': 'red'
            };
            return map[nivel] || 'blue';
        }

        // Carregar ao iniciar
        carregarEbooks();
    </script>

    <style>
        .results-count {
            margin-bottom: 20px;
            color: #666;
            font-size: 14px;
        }

        .price {
            font-size: 20px;
            font-weight: 700;
            color: #F4B627;
        }

        .category-tag {
            display: inline-block;
            padding: 4px 12px;
            background: #E8E4F3;
            color: #5B4E9D;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }

        .card-description {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            min-height: 60px;
        }
    </style>
</body>
</html>
