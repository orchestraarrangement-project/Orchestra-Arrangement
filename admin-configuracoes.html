<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurações - Orchestra Admin</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin-styles.css">
</head>
<body class="admin-body">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
        <div class="sidebar-header">
            <div class="logo-placeholder">ORCHESTRA</div>
            <span class="admin-badge">Admin</span>
        </div>

        <nav class="sidebar-nav">
            <a href="admin-dashboard.html" class="sidebar-link">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <rect x="3" y="3" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
                    <rect x="11" y="3" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
                    <rect x="3" y="11" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
                    <rect x="11" y="11" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
                </svg>
                Dashboard
            </a>

            <a href="admin-ebooks.html" class="sidebar-link">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M3 4H17M3 10H17M3 16H17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                Cursos
            </a>

            <a href="admin-partituras.html" class="sidebar-link">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <rect x="4" y="3" width="12" height="14" rx="1" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M8 7H12M8 10H12M8 13H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                Partituras
            </a>

            <a href="admin-usuarios.html" class="sidebar-link">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <circle cx="10" cy="7" r="3" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M5 17C5 14 7 12 10 12C13 12 15 14 15 17" stroke="currentColor" stroke-width="1.5"/>
                </svg>
                Usuários
            </a>

            <a href="#" class="sidebar-link">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M10 6V10L13 13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                Atividades
            </a>

            <a href="admin-configuracoes.html" class="sidebar-link active">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M10 7V10M10 13H10.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                Configurações
            </a>
        </nav>

        <div class="sidebar-footer">
            <a href="index.html" class="sidebar-link">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M3 7L10 3L17 7V16H3V7Z" stroke="currentColor" stroke-width="1.5"/>
                </svg>
                Ver Site
            </a>
            <button onclick="logout()" class="sidebar-link" style="border: none; background: none; width: 100%; text-align: left; cursor: pointer;">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M13 3H16C16.55 3 17 3.45 17 4V16C17 16.55 16.55 17 16 17H13M8 14L3 10M3 10L8 6M3 10H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                Sair
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Top Bar -->
        <header class="admin-header">
            <div class="header-left">
                <h1 class="page-title">Configurações</h1>
                <p class="page-subtitle">Gerencie suas preferências e segurança</p>
            </div>
        </header>

        <!-- Settings Content -->
        <section style="padding: 32px;">
            <div style="max-width: 800px;">
                <!-- Perfil -->
                <div class="content-box" style="margin-bottom: 24px;">
                    <h2 class="content-title">Informações do Perfil</h2>
                    <div style="display: flex; align-items: center; gap: 24px; margin-bottom: 24px;">
                        <div style="width: 80px; height: 80px; border-radius: 50%; background: var(--primary-color); color: white; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: 700;" id="avatarLetter">
                            A
                        </div>
                        <div>
                            <h3 style="font-size: 24px; font-weight: 700; margin-bottom: 4px;" id="userName">Admin</h3>
                            <p style="color: #666;" id="userEmail">admin@orchestra.com</p>
                            <p style="color: #666; font-size: 14px;"><span class="table-badge badge-purple" id="userType">Admin</span></p>
                        </div>
                    </div>
                </div>

                <!-- Segurança -->
                <div class="content-box" style="margin-bottom: 24px;">
                    <h2 class="content-title">Segurança</h2>
                    <form id="changePasswordForm" style="max-width: 500px;">
                        <div class="form-group">
                            <label class="form-label">Senha Atual</label>
                            <input type="password" id="senhaAtual" class="form-input" placeholder="Digite sua senha atual" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Nova Senha</label>
                            <input type="password" id="novaSenha" class="form-input" placeholder="Mínimo 6 caracteres" required minlength="6">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Confirmar Nova Senha</label>
                            <input type="password" id="confirmarSenha" class="form-input" placeholder="Digite novamente" required minlength="6">
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <rect x="5" y="7" width="6" height="7" rx="1" stroke="currentColor" stroke-width="1.5"/>
                                <path d="M6 7V4.5C6 3.11929 7.11929 2 8.5 2C9.88071 2 11 3.11929 11 4.5V7" stroke="currentColor" stroke-width="1.5"/>
                            </svg>
                            Alterar Senha
                        </button>
                    </form>
                </div>

                <!-- Sobre o Sistema -->
                <div class="content-box">
                    <h2 class="content-title">Sobre o Sistema</h2>
                    <p style="color: #666; line-height: 1.6; margin-bottom: 16px;">
                        <strong>Orchestra Music Platform</strong><br>
                        Versão 1.0.0<br>
                        Sistema de gerenciamento de cursos e partituras musicais
                    </p>
                    <div style="display: flex; gap: 12px;">
                        <span class="table-badge badge-green">✓ Backend Online</span>
                        <span class="table-badge badge-blue">✓ Supabase Conectado</span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="api.js"></script>
    <script>
        if (!localStorage.getItem('token')) {
            window.location.href = 'admin-login.html';
        }

        function logout() {
            api.logout();
        }

        // Carregar dados do usuário
        const usuario = api.getUsuario();
        if (usuario) {
            document.getElementById('avatarLetter').textContent = usuario.nome.charAt(0).toUpperCase();
            document.getElementById('userName').textContent = usuario.nome;
            document.getElementById('userEmail').textContent = usuario.email;
            document.getElementById('userType').textContent = usuario.tipo === 'admin' ? 'Administrador' : 'Usuário';
        }

        // Trocar senha
        document.getElementById('changePasswordForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const senhaAtual = document.getElementById('senhaAtual').value;
            const novaSenha = document.getElementById('novaSenha').value;
            const confirmarSenha = document.getElementById('confirmarSenha').value;

            if (novaSenha !== confirmarSenha) {
                alert('❌ As senhas não coincidem!');
                return;
            }

            if (novaSenha.length < 6) {
                alert('❌ A senha deve ter no mínimo 6 caracteres');
                return;
            }

            const submitBtn = e.target.querySelector('button[type="submit"]');
            const btnText = submitBtn.innerHTML;

            try {
                submitBtn.disabled = true;
                submitBtn.innerHTML = 'Alterando...';

                const response = await fetch('http://localhost:5000/api/auth/trocar-senha', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({
                        senhaAtual: senhaAtual,
                        novaSenha: novaSenha
                    })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.erro || 'Erro ao trocar senha');
                }

                alert('✅ Senha alterada com sucesso!');
                document.getElementById('changePasswordForm').reset();
            } catch (error) {
                console.error('Erro:', error);
                alert('❌ ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = btnText;
            }
        });
    </script>
</body>
</html>
